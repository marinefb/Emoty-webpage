<html>


<body>
  <script src="https://sdk.morphcast.com/mphtools/v1.1/mphtools.js"
    data-config="cameraPrivacyPopup, compatibilityUI, compatibilityAutoCheck"></script>
  <script src="https://ai-sdk.morphcast.com/v1.16/ai-sdk.js"></script>
  <script>

    // load config file
    fetch('config.json')
      .then(response => response.json())
      .then(data => {
        var apiKey = data.API_KEY

        CY.loader()
          .licenseKey(apiKey)
          //.addModule(CY.modules().FACE_AROUSAL_VALENCE.name, {smoothness: 0.70})
          .addModule(CY.modules().FACE_EMOTION.name, { smoothness: 0.40 })
          //.addModule(CY.modules().FACE_ATTENTION.name, {smoothness: 0.83})
          //.addModule(CY.modules().FACE_DETECTOR.name, {maxInputFrameSize: 320, smoothness: 0.83})
          //.addModule(CY.modules().DATA_AGGREGATOR.name, {initialWaitMs: 2000, periodMs: 1000})
          .load()
          .then(({ start, stop }) => start());


        //window.addEventListener(CY.modules().EVENT_BARRIER.eventName, (evt) => {
        //console.log('EVENT_BARRIER result', evt.detail);
        //});

        //window.addEventListener(CY.modules().DATA_AGGREGATOR.eventName, (evt) => {
        //console.log('MY DATA_AGGREGATOR result', evt.detail);
        //});

        window.addEventListener(CY.modules().FACE_EMOTION.eventName, (evt) => {
          //console.log('FACE_EMOTION result', evt.detail);
          console.log('FACE_EMOTION result', evt.detail.output.dominantEmotion);
          var emotion = evt.detail.output.dominantEmotion
          document.getElementById("emotion").textContent = emotion;
          if (emotion == "Happy") {

          }

          // convert emtion to number
          var emotions = ["Neutral", "Happy", "Sad", "Surprise", "Disgust", "Scared", "Angry"];
          var iEmotion = emotions.indexOf(emotion);

          // Send this emotion to ardunio through websocket
          socket.send(iEmotion);

        });

        MphTools.CameraPrivacyPopup.setText({
          "title": "Allow us to use your camera",
          "description": "This experience is designed to be viewed with your camera on. The next screen will ask your consent to access data from your camera.",
          "url": "https://YOUR_DOMAIN/<YOUR_PRIVACY_POLICY>"
        });


        // Create WebSocket connection.
        const socket = new WebSocket('ws://localhost:8765');

        // Connection opened
        socket.addEventListener('open', function (event) {
          console.log("Socket opened")
          //socket.send('Hello Server!');
        });

        // Listen for messages
        socket.addEventListener('message', function (event) {
          console.log(event.data);
        });

      })
      .catch(error => console.error('Error:', error));



  </script>

  <!-- your body part -->
  <p>you know what ? I am <span id="emotion"></span></p>

</body>

</html>